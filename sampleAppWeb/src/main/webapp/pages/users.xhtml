<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"	
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<ui:composition  template="../templates/default.xhtml">
	
	<ui:define name="head">
		<style>
			.ui-datatable .ui-column-filter {
				width: 200px;
			}
			ui-datatable-action{
			}
			ui-datatable-action tr td{
				border: medium none;
			    padding: 2px;
			}
		
		</style>
	</ui:define>
	<ui:define name="title">
		<h:outputText value="Sample Web Application" />
	</ui:define>
	
	<ui:define name="headerLogoTopNav">
		<ui:include src="/templates/includes/header.xhtml" />
	</ui:define>
	
	<ui:define name="content">

		<!-- Small Nav -->
		<div class="small-nav">
			User Management<span>&gt;</span>List Users
		</div>
		<!-- End Small Nav -->
		
		<!-- Main -->
		<div id="main">
			<div class="cl">&nbsp;</div>
			
			<!-- Content -->
			<div id="content">
				
				<!-- Box -->
				<div class="box">
					<h:form id="form">
						<p:growl id="growl" showDetail="true"/>  
						
						<p:dataTable var="person" value="#{personBean.lazyModel}"
							rowKey="#{person.username}" paginator="true" rows="10"
							paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
							rowsPerPageTemplate="5,10,30,50,100"
							selection="#{personBean.person}" selectionMode="single"
							id="personsTable" paginatorPosition="top"
							widgetVar="personsTable"
							emptyMessage="No users found with given criteria">

							<p:ajax event="rowSelect" listener="#{personBean.onRowSelect}" 
								update="#{(request.isUserInRole('ROLE_ADMIN')) ? ':form:displayEdit' : ':form:display'}" 
								oncomplete="#{(request.isUserInRole('ROLE_ADMIN')) ? 'personEditDialog.show()' : 'personDialog.show()'}"  />
							
							<f:facet name="header">  
					            <p:outputPanel>  
					            	<h:outputText value="List of Users" style="float:left; margin-top: 5px;" />  
					                <p:inputText  id="globalFilter" onkeyup="personsTable.filter()" 
					                	style="float:right;width:150px" />  
					                <h:outputText value="Search all fields:"  style="float:right; margin-top: 5px; margin-right: 5px;" />  
					            </p:outputPanel>  
					        </f:facet>  
  
							<p:column headerText="User Name" sortBy="#{person.username}"
								filterBy="#{person.username}" 
								id="username" >  
					            #{person.username}  
					        </p:column>
					        
					        <p:column headerText="First Name" sortBy="#{person.firstName}"
								filterBy="#{person.firstName}"
								id="firstName">  
					            #{person.firstName}  
					        </p:column>
					        
							<p:column headerText="Email" sortBy="#{person.email}" 
								filterBy="#{person.email}" 
                				id="email">  
					            #{person.email}  
					        </p:column>
					        
						</p:dataTable>

						<p:dialog header="User Detail" widgetVar="personDialog" resizable="false"  
					              width="500" showEffect="explode" hideEffect="explode" height="300" 
					               rendered="#{request.isUserInRole('ROLE_USER')}">  
					  
					        <h:panelGrid id="display" columns="3" cellpadding="10"  
								cellspacing="10"  >  
					  
					            <h:outputText value="User Name " />  
					            <h:outputText value=" : " />  
					            <h:outputText value="#{personBean.person.username}" />  
					  			
					  			<h:outputText value="First Name " /> 
					  			<h:outputText value=" : " /> 
					            <h:outputText value="#{personBean.person.firstName}" />
					           
					            <h:outputText value="Last Name " />  
					            <h:outputText value=" : " />
					            <h:outputText value="#{personBean.person.lastName}" />
					            
					            
					            <h:outputText value="Civility " />  
					            <h:outputText value=" : " />
					            <h:outputText value="#{personBean.person.civility.label}" />  
					  			
					            
					            <h:outputText value="Birth Date " />  
					            <h:outputText value=" : " />
					            <p:calendar  style="width:200px;  visibility: visible;" value="#{personBean.person.birthDate}" 
										pattern="dd/MM/yyyy"   navigator="true" readonlyInput="true" disabled="true"
										required="true"/>   
					            
					            <h:outputText value="Email" /> 
					            <h:outputText value=" : " /> 
					            <h:outputText value="#{personBean.person.email}" />  
					            
					            <h:outputText value="Active:" />  
					            <h:outputText value=" : " />
					            <h:outputText value='#{(personBean.person.isEnabled eq "true") ? "Yes" : "No"}' id="isEnabled" />  
					            
					            <h:outputText value="Roles "  /> 
					  			<h:outputText value=" : " /> 
					            <p:dataGrid style="width:200px;" value="#{personBean.person.roles}" var="role" columns="1"
					            	  id="roles" rendered="#{personBean.person.roles != null}" >
					            	<p:column>  
							               <h:outputText value="#{role.roleDesc}" />  
							        </p:column> 
					            </p:dataGrid>
					        </h:panelGrid>  
					    </p:dialog>  
					    
					    <p:dialog header="User Detail" widgetVar="personEditDialog" resizable="false"  
					             width="500" showEffect="explode" hideEffect="explode" height="350" 
					             rendered="#{request.isUserInRole('ROLE_ADMIN')}"  >  
							<h:panelGrid width="100%"  id="displayEdit" columns="4" cellpadding="10"  
								cellspacing="10"  >  
					  
					            <h:outputText value="User Name " />  
					            <h:outputText value=" : " />  
					            <p:inputText style="width:200px;  visibility: visible;" value="#{personBean.person.username}" id="username" readonly="true"/>  
					  			<p:message  for="username" />
					  			
					  			<h:outputText value="Email" /> 
					            <h:outputText value=" : " /> 
					            <p:inputText style="width:200px;  visibility: visible;" value="#{personBean.person.email}" id="email" readonly="true"/>  
					            <p:message  for="email" />
					            
					  			<h:outputText value="First Name "  /> 
					  			<h:outputText value=" : " /> 
					            <p:inputText style="width:200px;  visibility: visible;" value="#{personBean.person.firstName}" id="firstName"/>
					            <p:message  for="firstName" />
					           
					            <h:outputText value="Last Name " />  
					            <h:outputText value=" : " />
					            <p:inputText  style="width:200px;  visibility: visible;" value="#{personBean.person.lastName}" id="lastName"/>
					            <p:message  for="lastName" />

					            <h:outputText value="Birth Date " />  
					            <h:outputText value=" : " />
					            <p:calendar  style="width:200px;  visibility: visible;" value="#{personBean.person.birthDate}" id="birthDate" showButtonPanel="true"
										pattern="dd/MM/yyyy"  yearRange="c-50:c+1" navigator="true" readonlyInput="true"
										required="true"/> 
					            <p:message  for="birthDate" />
								
								<f:facet name="footer">  
					                <p:commandButton type="submit" id="Update"   style="margin-right: 20px;"
										actionListener="#{personBean.updateUser}" value="Update"
										icon="ui-icon-arrowrefresh-1-w" ajax="false"/>
					            </f:facet> 
					       	</h:panelGrid>   
					    </p:dialog>  
					</h:form>	
					
				</div>
				<!-- End Box -->

			</div>
			<!-- End Content -->
			
			<!-- Sidebar -->
			<div id="sidebar">
				
				<!-- Box -->
				<div class="box">
					
					<!-- Box Head -->
					<div class="box-head">
						<h2>Management</h2>
					</div>
					<!-- End Box Head-->
					
					<div class="box-content">
					<h:form>
					<p:panel rendered="#{request.isUserInRole('ROLE_ADMIN')}">
						<h:outputLink styleClass="add-button" id="openRegisterUser" value="javascript:void(0)" onclick="dlg.show()">
							<span>Add new User</span>
						</h:outputLink>  
						<div class="cl">&nbsp;</div>
						
						<p class="select-all">
							<input type="checkbox" class="checkbox" />
								<label>select all</label></p>
						<p><a href="#">Delete Selected</a></p>
						
						<p:dialog id="dialog" header="Login" widgetVar="dlg">
						
							 <h:panelGrid id="display" columns="3" cellpadding="4">  
					  
					            <h:outputText value="User Name " />  
					            <h:outputText value=" : " />  
					            <p:inputText value="#{personBean.person.username}" 
										id="username" required="true" label="User Name" />
					  			
					  			<h:outputText value="First Name " /> 
					  			<h:outputText value=" : " /> 
					  			<p:inputText value="#{personBean.person.firstName}" 
										id="firstName" required="true" label="First Name" />
					           
					            <h:outputText value="Last Name " />  
					            <h:outputText value=" : " />
					            <p:inputText value="#{personBean.person.lastName}" 
										id="lastName" required="true" label="Last Name" />
					            
					            
					            <h:outputText value="Civility " />  
					            <h:outputText value=" : " />
					            <p:inputText value="#{personBean.person.civility}" 
										id="civility" required="true" label="Civility" />
					  			
					            
					            <h:outputText value="Birth Date " />  
					            <h:outputText value=" : " />
					            <p:inputText value="#{personBean.person.birthDate}" 
										id="birthDate" required="true" label="Birth Date" /> 
					            
					            <h:outputText value="Email" /> 
					            <h:outputText value=" : " /> 
					            <p:inputText value="#{personBean.person.email}" 
										id="email" required="true" label="Email" />
					            
					            <h:outputText value="Active:" />  
					            <h:outputText value=" : " />
					            <p:inputText value="#{personBean.person.isEnabled}" 
										id="isEnabled" required="true" label="Active" />
										
								<f:facet name="footer">
									<p:commandButton id="registerButton" value="Register User" 
										actionListener="#{loginBean.login}" 
										oncomplete="handleRegisterRequest(xhr, status, args)"/>
								</f:facet>
					        </h:panelGrid>  
							
						
						 </p:dialog>
					
					<script type="text/javascript">
						function handleRegisterRequest(xhr, status, args) {
							if(args.validationFailed || !args.loggedIn) {
								jQuery('#dialog').effect("shake", { times:3 }, 100);
							} else {
								dlg.hide();
								jQuery('#loginLink').fadeOut();
							}
						}
					</script>
					</p:panel>
					</h:form>
					<div class="cl">&nbsp;</div>
						
					</div>
					 
				</div>
				
				<!-- End Box -->
			</div>
			<!-- End Sidebar -->
			
			<div class="cl">&nbsp;</div>			
		</div>
		<!-- Main -->
	</ui:define>
</ui:composition>
</html>